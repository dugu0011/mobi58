 {% extends "web/jinja2/base.html.j2" %}
{% block content %}


<!-- Begin Page Content -->
<section class="py-md-5">
	<div class="container-fluid">
		<div class="col-12">
			<div class="card mb-4 border-1">
				<div class="card-header py-3 px-0 align-items-center bg-white border-0">
					<div class="row">
						<div class="col-9">
							<h3 class="m-0 px-3 font-weight-bold text-dark">Crusher Outbound Exit</h3>
						</div>
                        <div class="col-3">
							<h3 class="m-0 text-dark" style="font-size:1rem;">Transaction ID: {%for i in txn_id%}<b>{{i.crusher_transaction_id}}</b>{%endfor%}</h3>
						</div>
					</div>
				</div>
				<form method="post" enctype="multipart/form-data">
				{{csrf_input}}

                    <div class="card-body px-0 text-dark font-weight-bold">
                        
                        {% for u in outbound_data %}
                        <input type="hidden" value="{{u.company_name.id}}" name="company_id">
                        
                        <div class="row mx-0">                   
                                
                                <div class="col-7 bg-primary">
                                    <h5 style="color:white;" class="mt-1 indetail"><i class="fa fa-plus"></i> Vehicle IN </h5>
                                </div>	
                                <div class="col-5 bg-primary text-light">
                                    <span class="m-0 px-3">
                                    <span class="text-right">In Date: {{u.in_date}} </span>
                                    </span>
                                    <span class="m-0 px-1">
                                    <span class="text-right">In Time: {{u.in_time}}</span>
                                    </span>
                                </div>
                            
                        </div>

                                  
                                <div class="row mx-0 indetailform" style="display:none;">
                                    {#<div class="col-lg-3 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="customer_name">Customer*</label>
                                            <input type="hidden" value="{{u.customer_name.id}}" name="customer_name" id="customer_name">
                                            <input  class="form-control" placeholder="{{u.customer_name}}"  readonly>
                                        </div>
                                    </div>#}
                                            <input type="hidden" value="{{u.in_date}}" name="in_date" id="in_date"  class="form-control"  readonly>
                                        
                                            <input type="hidden" value="{{u.in_time}}" name="in_time" id="in_time" class="form-control" readonly>
                                        
                                    <div class="col-lg-3 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="truck_no">Vehicle No*</label>
                                            <input type="text" value="{{u.vehicle_no}}" name="vehicle_no" id="vehicle_no" class="form-control" readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="driver_name">Driver Name*</label>
                                            {# value="{{mine_transactions.driver_name|default:''}}"#}
                                            <input type="text" value="{{u.driver_name}}"  name="driver_name" id="driver_name" class="form-control"  readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="mobile">Mobile*</label>
                                            <input type="text" name="mobile" id="mobile" value="{{u.mobile}}"  class="form-control"  readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="kaata_no">Kaata No.*</label>
                                            <input type="text" name="kaata_no" id="Kaata_no" value="{{u.in_kaata.kaata_no}}" class="form-control" readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="slip_no">Slip No.*</label>
                                            <input type="number" name="slip_no" id="slip_no" value="{{u.slip_no}}" class="form-control" readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="in_weight">In Weight <small>(Ton)</small>*</label>
                                            <input type="text" name="in_weight" id="in_weight" value="{{u.in_weight}}" placeholder="0.00" class="form-control"  readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="advance_recieved">Advance Received*</label>
                                            <input type="number" name="advance_recieved" id="advance_recieved" {% if u.received_advance %} value="{{u.received_advance}}" {% else %}value="0"{% endif %} placeholder="0.00" class="form-control" readonly>
                                        </div>
                                    </div>
                                
                                </div>
                                {% endfor %}
                                <hr>

                            
                            <div class="row mx-0">
                                <div class="col-5 bg-primary">
                                    <h5 style="color:white;"> Out Detail </h5>
                                </div>
                                	
                                <div class="col-7 bg-primary text-light">
                                    <span class="m-0 px-3">
                                    <span class="text-right">Out Date: 
                                    {% if 24 in userroles %}
                                        <input type="text" value="{{current_date}}" name="out_date" id="out_date" style="font-size:0.8rem!important;"> 
                                        {%else%}
                                        <input type="hidden" value="{{current_date}}" name="out_date">
                                        {{current_date}}
                                    {%endif%}
                                     </span>
                                    </span>
                                    <span class="m-0 px-1">
                                    <span class="text-right">Out Time: 
                                    {% if 24 in userroles %}
                                        <input type="text" value="{{current_time}}" name="out_time" id="out_time"  style="font-size:0.8rem!important;" class=""></span>
                                        {%else%}
                                        <input type="hidden" value="{{current_time}}" name="out_time">
                                        {{current_time}}
                                    {%endif%}
                                    </span>
                                </div>    
                            </div>

                        <div class="row mx-0">
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="vendor_name">Customer*</label>
                                    <select class="custom-select form-control form-control-user rounded-1 select2_dropdown" name="vendor_name" id="vendor_name" required>
                                        <option value="" selected>Select</option>    
                                        {% for data in customers %}
                                        <option value="{{data.id}}">{{data.customer_name}}</option>
                                        {%endfor%}
                                    </select>
                                </div>
                            </div>

                            <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="out_weight">Location*</label>
                                        <input type="text" name="location" id="location" placeholder="Location" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="crusher">Crusher Name*</label>
                                        <select class="custom-select form-control form-control-user rounded-1 select2_dropdown crusher" name="crusher" id="crusher" required>
                                            {#<option value="" selected>Select</option>#}    
                                            {% for data in crusher %}
                                            <option value="{{data.id}}">{{data.crusher_name}}</option>
                                            {%endfor%}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="out_kaata">Out Kaata No.*</label>
                                        <select class="custom-select form-control form-control-user rounded-1 select2_dropdown" name="out_kaata" id="out_kaata" required>
                                            <option value="" selected>Select</option>
                                            {% for data in kaata_number %}
                                            <option value="{{data.id}}">{{data.kaata_no}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                                          
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="machine">Machine*</label>
                                        <select class="custom-select form-control form-control-user rounded-1 select2_dropdown" name="machine" id="machine" required>
                                            {#<option value="" selected>Select</option>#}
                                            {% for data in machines %}
                                            <option value="{{data.id}}">{{data.name}}</option>
                                            {%endfor%}
                                        </select>
                                    </div>
                                    <input type='hidden' id="subcategory">
                                </div>
                                
                            
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="out_weight">Full Load <small>(Ton)</small>*</label>
                                        <input type="text" name="out_weight" id="out_weight" placeholder="0.00" class="form-control sbwt" required>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="net_weight">Net Load <small>(Ton)</small>*</label>
                                        <input type="text" name="net_weight" id="net_weight" placeholder="0.00" class="form-control net_weight" readonly>
                                    </div>
                                </div>
                                
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="ravana_no">TP No.*</label>
                                        <input type="text" name="ravana_no" id="ravana_no" placeholder="0.00" class="form-control" required>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-3 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="invoice_no">Invoice No.</label>
                                        <input type="text" name="invoice_no" id="invoice_no" class="form-control">
                                    </div>
                                </div>
                                    
                            </div>
                            <hr>
                            
                            <div class="row mx-0">
                                <div class="col-lg-12 col-md-12 col-sm-12 bg-primary pt-1">
                                    <h5 style="color:white;"> Bill Detail </h5>
                                </div>
                            </div>   

                            <div id="add-new-bill-form">
                                <div class="row mx-0">
                                    <div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="product">Product*
                                            <!--<a href="javascript:void(0);" onclick="addnewbill(1)"><i class="fas fa-plus-circle text-success"></i></a>-->
                                            
                                        </label>
                                            <select class="custom-select form-control form-control-user rounded-1 select2_dropdown product" name="product" id="product1" required onchange="ProductChange(this,1)">
                                                <option value="" selected>Select</option>
                                                {% for data in products %}
                                                <option value="{{data.id}}" class="{{data.sale_rate}},{{data.bill_rate}},{{data.gst_percent}},{{data.base_bill_rate}},{{data.bill_royalty_charges}},{{data.is_gst}},{{data.base_sale_rate}},{{data.sale_royalty_charges}}">{{data.item_name}}</option>
                                                {%endfor%}
                                            </select>
                                        </div>
                                    </div>
                                    <input type="hidden" name="hdnTxtControlNumber" id="hdnTxtControlNumber" value="1">
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="uom">UOM*</label>
                                            <input type="text" name="uom" id="uom1" value="Ton" style="font-size:0.8rem;" class="form-control uom" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="qty">Qty.*</label>
                                            <input type="text" name="qty" style="font-size:0.8rem;" id="qty1" onchange="QuantityChange(this,1)" placeholder="0.00" class="form-control qty" required>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="b_price">Price*</label>
                                            <input type="text" name="b_price" id="b_price1" onchange="RateChange(this,1)" placeholder="0.00" style="font-size:0.8rem;" class="form-control b_price" {% if companies.is_dynamic != True %}readonly{%endif%}>
                                        </div>
                                    </div>
                                    <div class="col-lg-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="bill_discounted_amount">Amount</label>
                                            <input type="number" name="bill_discounted_amount" id="bill_discounted_amount1" placeholder="0.00" style="font-size:0.8rem;" class="form-control bill_discounted_amount" readonly>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="gst_per">% GST*</label>
                                
                                            <input type="text" name="gst_per" id="gst_per1" style="font-size:0.8rem;" {% if price_gst %} value="{{price_gst.gst_percent}}"{% endif %} placeholder="0.00" class="form-control gst_per" readonly>
                                            
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="gst_amt">GST*</label>
                                            <input type="number" name="igst_amt" id="igst_amt1" placeholder="0.00" style="font-size:0.8rem;" class="form-control igst_amt" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="royalty_amt">Royalty*</label>
                                            <input type="number" name="royalty_amt" id="royalty_amt1" placeholder="0.00" style="font-size:0.8rem;" class="form-control royalty_amt" readonly>
                                        </div>
                                    </div>

                                            <input type="hidden" name="hdn_royalty" id="hdn_royalty1" placeholder="0.00" style="font-size:0.8rem;" class="hdn_royalty" readonly>
                                        
                                        <input type="hidden" name="" id="billing_amount" placeholder="0.00" class="form-control" readonly>
                                    <div class="col-lg-2 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="bill_total_amount">Total Amount</label>
                                            <input type="number" name="bill_total_amount" id="bill_total_amount1"  placeholder="0.00" class="form-control bill_total_amount" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-12 mt-4">
                                        <a href="javascript:void(0);" class="border-primary btn" onclick="addnewbill(1)" style="padding:0.1rem 0.35rem!important;"><i class="fas fa-plus fz-10 delete-row mt-1"></i></a>
                                        <a type="button" class="delete-row delete-row btn border-danger text-danger" onclick="removeRowBill(this)" style="padding:0.1rem 0.35rem!important;"><i class="fas fa-trash-alt fz-10 delete-row mt-1"></i></a>
                                    </div>
                                </div>
                            </div>
                                <div class="row mx-0">
                                    <div class="col-lg-9 col-md-8 col-sm-12"></div>
                                    <div class="col-md-2 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="total_amount">Grand Amount*</label>
                                            <input type="number" name="total_amount" id="total_amount1" value="0" class="form-control total_amount" readonly>
                                        </div>
                                    </div>
                                    <div class="col-lg-1 col-md-2 col-sm-12"> </div>
                                </div>                      
                        <div class="row mx-0">
                            <div class="col-lg-12 col-md-12 col-sm-12 bg-primary pt-1">
                                <h5 style="color:white;"> Sale Detail </h5>
                            </div>    
                        </div>
                        <div id="add-new-sale-form">    
                            <div class="row mx-0">
                                <div class="col-md-2 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="b_item_name">Product*</label>
                                        <input type="text" name="s_item_name" id="s_item_name1" class="form-control" readonly>
                                         <input type="hidden" name="hdnTxtControlNumber" id="hdnTxtControlNumber" value="1">
                                    </div>
                                </div>
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="uom">UOM*</label>
                                        <input type="text" name="s_uom" id="s_uom1" value="Ton" class="form-control uom" readonly>
                                    </div>
                                </div>
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="qty">Qty.*</label>
                                        <input type="text" name="s_qty" id="s_qty1" onchange="SaleQuantityChange(this,1)" placeholder="0.00" style="font-size:0.8rem;" class="form-control s_qty">
                                    </div>
                                </div>
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="s_price">Price*</label>
                                        <input type="text" name="s_price" id="s_price1" onchange="SaleRateChange(this,1)" placeholder="0.00" style="font-size:0.8rem;" class="form-control s_price"{%if companies.is_dynamic != True%} readonly{%endif%}>
                                    </div>
                                </div>
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="sale_discounted_amount">Amount</label>
                                        <input type="text" name="sale_discounted_amount" id="sale_discounted_amount1" placeholder="0.00" class="form-control s_price" readonly>
                                    </div>
                                </div>
                                {#<div class="col-lg-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="sale_discounted_price">Discounted Price</label>
                                        <input type="number" name="sale_discounted_price" id="sale_discounted_price1" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                </div>#}
                                {#
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="gst_per">%GST*</label>
                                        <input type="number" name="s_gst_per" style="font-size:0.8rem;" id="s_gst_per1" {% if price_gst %} value="{{price_gst.gst_percent}}"{% endif %} value="0" placeholder="0.00" class="form-control s_gst_per" readonly>
                                    </div>
                                </div>#}
                                <!--<div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="gst_amt">CGST*</label>
                                        <input type="number" name="s_gst_amt" style="font-size:0.8rem;" id="s_gst_amt" value="0" placeholder="0.00"  class="form-control s_gst_amt" readonly>
                                    </div>
                                </div>-->
                                
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="gst_amt">GST*</label>
                                        <input type="number" name="s_igst_amt" style="font-size:0.8rem;" id="s_igst_amt1" value="0" class="form-control s_gst_amt" placeholder="0.00" readonly>
                                    </div>
                                </div>
                                <div class="col-md-1 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="s_royalty_amt">Royalty*</label>
                                        <input type="number" name="s_royalty_amt" style="font-size:0.8rem;" id="s_royalty_amt1" class="form-control s_royalty_amt" placeholder="0.00" readonly>
                                    </div>
                                </div>
                                     <input type="hidden" name="shdn_royalty" id="hdn_s_royalty1" placeholder="0.00" style="font-size:0.8rem;" class="hdn_s_royalty" readonly>
                                {#<div class="col-md-1 col-12 mt-4">
                                    <a href="javascript:void(0);" class="border-primary btn" onclick="addnewsale()"><i class="fas fa-plus fz-20 delete-row mt-1"></i></a>
                                    <a type="button" class="delete-row delete-row btn border-danger text-danger mx-3" onclick="removeRowsale(this)"><i class="fas fa-trash-alt fz-20 delete-row mt-1"></i></a>
                                </div>#}
                                <div class="col-md-2 col-sm-12">
                                    <div class="form-group mb-4">
                                        <label for="sale_total_amount">Total Amount*</label>
                                        <input type="number" name="sale_total_amount" id="sale_total_amount1" value="0" class="form-control sale_total_amount" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>                            
                        <div class="row mx-0">
                            <div class="col-lg-8 col-md-7 col-sm-12"></div>
                            <div class="col-md-2 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="total_amount">Grand Amount*</label>
                                    <input type="number" name="sale_grand_amount" id="sale_grand_amount1" value="0" class="form-control sale_grand_amount" readonly>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-12"> </div>
                        </div>   
                        <div class="row mx-0">
                            <div class="col-lg-12 col-md-12 col-sm-12 bg-primary pt-1">
                                <h5 style="color:white;"> Calculation </h5>
                            </div>    
                        </div>
                        <div class="row mx-0">
                            
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="commission">Commission</label>
                                    <input type="text" name="commission" id="commission" placeholder="0.00" class="form-control">
                                </div>
                            </div>
                            {% for u in outbound_data %}
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="advance">Received Advance</label>
                                    <input type="text" name="advance" id="advance" value="{{u.received_advance}}" placeholder="0.00" class="form-control advance" readonly>
                                </div>
                            </div>
                            {% endfor %}
                            <div class="col-md-2 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="other_charges">Other Charges</label>
                                    <input type="text" name="other_charges" id="other_charges" placeholder="0.00" class="form-control other_charges" onblur="OtherCharges()">
                                </div>
                            </div>
                            {#
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="balance">Balance*</label>
                                    <input type="text" name="balance" id="balance" placeholder="0.00" class="form-control" readonly>
                                </div>
                            </div>#}
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="pay_received">Payment Received*</label>
                                    <input type="number" name="pay_received" id="s_pay_received" step=".01" value="0" placeholder="0.00" class="form-control s_pay_received" required>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="p_amt">Pending Amount*</label>
                                    <input type="number" name="p_amt" id="s_p_amt" placeholder="0.00" class="form-control total_pending" readonly>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-3 col-sm-12">
                                <div class="form-group mb-4">
                                    <label for="grand_total">Grand Total*</label>
                                    <input type="text" name="grand_total" id="grand_total" placeholder="0.00" class="form-control grand_total" readonly>
                                </div>
                            </div>
                        </div>
                        <hr>

                        <div class="row mx-0 position-relative">
                            <div class=" col-12 pt-4 text-center">
                                <button type="reset" class="btn btn-white text-dark border rounded-1 bg-white f-s-18 px-4 py-2 mr-3">Reset</button>
                                <button type="submit"  class="btn bg-gradient-primary text-white rounded-1 f-s-18 px-4 py-2">Submit</button>
                            </div>
                        </div>
                    </div>
                
				</form>
			</div>
		</div>
	</div>
</section>
<!-- End Here -->
<script src="{{static ('vendor/jquery/jquery.min.js')}}"></script>
<script src="{{static ('js/outbound-bill.js')}}"></script>

<script>
    $(document).ready(function() {
        $('.select2_dropdown').select2();
        });
</script>

<script>
    $(document).ready(function(){
        $('.indetail').click(function(){
            $('.indetailform').toggle();
        });
    });
</script>


<script>
    $(function() {
        $('#product').change(function(){
            $('#price').val($(this).find(':selected').attr('class'));
            });
        });
</script>

<script>
    $(document).ready(function(){
        $('.sbwt').blur(function(e){
       let in_var = $('#in_weight').val();
       let out_var = $('#out_weight').val();
       let b_amt = $('#billing_amt').val();

       if (parseFloat($('#out_weight').val()) < parseFloat($('#in_weight').val()))
            {
                alert("Full load should be more than "+in_var);
                $('#out_weight').val('');
                return false; 
            }

       if ($('#product').val() == '')
        {
            alert("Please Select a Product");
            $('#out_weight').val('');
            return false; //preventDefault;
        }
        let sub_weight = out_var-in_var

        $('#net_weight').val(sub_weight.toFixed(2));
        $('#qty').val(sub_weight);
        let bill_AMT = $('#b_price').val()*sub_weight;
        
        $('#billing_amount').val(bill_AMT);
        $('.bill_discounted_amount').val($('#billing_amount').val()); 
        t_amt = sub_weight * $('#price').val();
        let p_amt = t_amt-b_amt
        var dec_amount = t_amt.toFixed(2); 
        $('#amount').val(dec_amount);
        
        var dsd = parseFloat($('#gst_per').val());
        //var amm = parseFloat($('#billing_amount').val());
        //var amm = parseFloat($('#amount').val());
        var amm = parseFloat($('.bill_discounted_amount').val());
        var total_gst = amm*dsd/100;
        $('#gst_amt').val(total_gst.toFixed(2));
        
        var GST = $('#gst_amt').val(); 
        var bill = $('#billing_amount').val();
        var damt = $('#bill_discounted_amount').val();
        var advance_amt = $('#advance').val();
        //$('#grand_total').val(parseFloat(GST) + parseFloat(bill)-parseFloat(advance_amt)); // Gst Amount + Billing Amount = Grand Total
        //$('#balance').val($('#grand_total').val());
        
        $('.total_amount').val(parseFloat(GST) + parseFloat(damt));

        // QTY is Net Load
        parseFloat($('#s_qty').val(sub_weight.toFixed(2)));

        
        var sale_QTY = parseFloat($('#s_qty').val());
        var sale_PRICE = parseFloat($('#s_price').val());

        var total_bill = sale_QTY*sale_PRICE;
        $('#s_billing_amount').val(total_bill.toFixed(2));
        

        var dsd = parseFloat($('#s_gst_per').val());
        var amm = parseFloat($('.amount').val());
        
        $('#s_gst_amt').val($('#gst_amt').val());
        
        var SGST = $('#s_gst_amt').val(); 
        var sbill = $('#s_billing_amount').val();

        $('#sale_total_amount').val(parseFloat(SGST) + parseFloat(sbill));

        $('#grand_total').val($('.sale_total_amount').val());
        
        // copy bill price to discount
        //$('#bill_discounted_price').val($('#b_price').val());
        $('.total_pending').val(parseFloat($('.grand_total').val())-parseFloat($('.advance').val()));
           
    });
    });
    
</script>




<script>
    // Depend on Discount % input value.
    $('#discount').keyup(function(e){

        if ($('#out_weight').val() == '' || $('#out_weight').val() == 0)
            {
            alert("Full Load can't be blank!")
            $('#discount').val('');
            return false;
            } 

        var dis = $('#discount').val();
        //var discount_from = $('#b_price').val();
        var billamt =  $('#billing_amount').val();
        var cal_discount = dis*billamt/100;
        var substracted = billamt-cal_discount;
        $('#bill_discounted_amount').val(substracted);
        $('#bill_discounted_price').val(cal_discount);

        //var billamt = $('#qty').val()*$('#bill_discounted_price').val();
        //$('#billing_amount').val(billamt.toFixed(2));

        var calculate_gst =  $('#bill_discounted_amount').val()*$('#gst_per').val()/100;
        $('#gst_amt').val(calculate_gst.toFixed(2));
        $('#s_gst_amt').val($('#gst_amt').val());
       
        var cal_t_amt = parseFloat($('#bill_discounted_amount').val()) + parseFloat($('#gst_amt').val());
        $('#total_amount').val(cal_t_amt.toFixed(2));

        // for sale detail section
        var sdis = $('#discount').val();
        var s_discount_from = $('#s_billing_amount').val();
        var s_cal_discount = sdis*s_discount_from/100;
        var s_substracted = s_discount_from-s_cal_discount;
        $('#sale_discounted_amount').val(s_substracted);
        $('#sale_discounted_price').val(s_cal_discount);

       // var s_billamt = $('#s_qty').val()*$('#sale_discounted_price').val();
       // $('#s_billing_amount').val(s_billamt.toFixed(2));

        var s_cal_t_amt = parseFloat($('#sale_discounted_amount').val()) + parseFloat($('#s_gst_amt').val());
        console.log(s_discount_from);
        console.log(s_gst_amt);
        $('#sale_total_amount').val(s_cal_t_amt.toFixed(2));

        $('#grand_total').val($('#sale_total_amount').val());

    });
</script>

<script>
$(document).ready(function(){
    $('#s_pay_received').keyup(function(e){
        
        //if ($('#s_pay_received').val() > $('#grand_total').val());
            //alert("Please enter less then grand_total.");
          //e.preventDefault()
        var s_fixed_decimal = $('#grand_total').val()-$('#s_pay_received').val()-$('#advance').val();
        $('#s_p_amt').val(s_fixed_decimal.toFixed(2));
    });
 });    
</script>

{#
<script>

    $('.other_charges').on('input',function(){
        var o_charges = $('.other_charges').val();
        if (o_charges.length < 0 || o_charges == '')
                o_charges = 0;
        var o_sale_total_amount = $('.grand_total').val();
        var o_grand =  parseFloat(o_charges)+parseFloat(o_sale_total_amount);
        $('.grand_total').val(o_grand);
        });
</script>
#}


<script>
  /*  $(function() {
        $('.product').change(function(){
             var dat = $(this).find(':selected').attr('class');
             var dd = dat.split(',');  
             $('.price').val(dd[0]);
             $('.b_price').val(dd[1]);
             $('.gst_per').val(dd[2]);
             $('.out_bill_price').val(dd[1]);
            $('.b_item_name').val($(this).find(':selected').text());
            
            $('.s_price').val(dd[0]);
            $('.s_gst_per').val(dd[2]);
            //$('#bill_discounted_price').val(dd[1]);
            
            $('.s_item_name').val($(this).find(':selected').text());
            });
        });*/

        function OtherCharges(){ 
            var o_charges = $('.other_charges').val();
            if (o_charges.length < 0 || o_charges == '')
                o_charges = 0;
                console.log(o_charges);
            var o_sale_total_amount = $('.sale_grand_amount').val();
            var o_grand =  parseFloat(o_charges)+parseFloat(o_sale_total_amount);
            $('.grand_total').val(o_grand);
        }

    function QuantityChange(val,num)
    {   
        var total_amount = new Array();
        var totalAmt;
        var billqty=document.getElementById('qty'+num);
        var price=document.getElementById('b_price'+num);
        var gst=document.getElementById('gst_per'+num);
        var bill_discounted_amount=document.getElementById('bill_discounted_amount'+num);
        var igst_amt=document.getElementById('igst_amt'+num);
        var s_igst_amt=document.getElementById('s_igst_amt'+num);
        var bill_total_amount=document.getElementById('bill_total_amount'+num);
        var total_amount=document.getElementById('total_amount1');
        var count=document.getElementById('hdnTxtControlNumber').value;

        var sale_qty_reset=document.getElementById('s_qty'+num);
        var sale_discounted_amount=document.getElementById('sale_discounted_amount'+num);
        var s_gst_amt=document.getElementById('s_igst_amt'+num);
        var sale_total_amount=document.getElementById('sale_total_amount'+num);
        
        var royalty_amt=document.getElementById('royalty_amt'+num);
        var hdn_royalty=document.getElementById('hdn_royalty'+num);
        var dat = hdn_royalty.value;
        var dd = dat.split(','); 
        royalty_amt.value=$(val).val()*dd[4];

        //alert('quantitychaange');
        var billAmnt = $(val).val()*$(price).val();
        $(bill_discounted_amount).val(billAmnt.toFixed(2));
        var manual_Bill_Amt = $(bill_discounted_amount).val();
        var manualGSTpercentage =  $(gst).val();
        // alert(manualGSTpercentage);
        var fixed_digit_gst = parseFloat(manual_Bill_Amt)*parseFloat(manualGSTpercentage)/100;
        //alert(fixed_digit_gst);
        $(igst_amt).val(fixed_digit_gst.toFixed(2));
        s_igst_amt.value =fixed_digit_gst.toFixed(2);
        if (billqty.length > 0 || billqty == '')
            sale_qty_reset.value = 0;

        var s_bill_amt = sale_discounted_amount.value;
        var s_gst_amount = s_gst_amt.value;

        if (s_bill_amt.length < 0 || s_bill_amt == '')
            s_bill_amt = 0;

        if (s_gst_amount.length < 0 || s_gst_amount == '')
            s_gst_amount = 0;
        var sale_total_amnt = parseFloat(s_gst_amount)+parseFloat(s_bill_amt);
        //alert(sale_total_amnt);
        sale_total_amount.value = sale_total_amnt;
        //Total Amount
        var total_amt = parseFloat(billAmnt)+parseFloat(fixed_digit_gst);
        var total_amt_royalty = parseFloat(billAmnt)+parseFloat(fixed_digit_gst)+parseFloat($(val).val()*dd[4]);
        if (dd[5] == 'True')
            $(bill_total_amount).val(total_amt.toFixed(2));
           else
            $(bill_total_amount).val(total_amt_royalty.toFixed(2));
        var grand = 0
		for(var d=1; d<=count; d++){
            bill_total_amount=document.getElementById('bill_total_amount'+d);
          //  alert(bill_total_amount.value);
			grand = grand + parseFloat(bill_total_amount.value)
		}
       //  alert(grand);
		console.log(grand)
		$('.total_amount').val(grand.toFixed(2));
    }

    function RateChange(val,num)
    {
        var totalAmt;
        var qty=document.getElementById('qty'+num);
        var gst=document.getElementById('gst_per'+num);
        var bill_discounted_amount=document.getElementById('bill_discounted_amount'+num);
        var igst_amt=document.getElementById('igst_amt'+num);
        var s_igst_amt=document.getElementById('s_igst_amt'+num);
        var bill_total_amount=document.getElementById('bill_total_amount'+num);
        var total_amount=document.getElementById('total_amount1');
        var count=document.getElementById('hdnTxtControlNumber').value;
        //alert('quantitychaange');
        var billAmnt = $(val).val()*$(qty).val();
        $(bill_discounted_amount).val(billAmnt.toFixed(2));
        var manual_Bill_Amt = $(bill_discounted_amount).val();
        var manualGSTpercentage =  $(gst).val();
        // alert(manualGSTpercentage);
        var fixed_digit_gst = parseFloat(manual_Bill_Amt)*parseFloat(manualGSTpercentage)/100;
        $(igst_amt).val(fixed_digit_gst.toFixed(2));
        s_igst_amt.value =fixed_digit_gst.toFixed(2);

        //Total Amount
        var total_amt = parseFloat(billAmnt)+parseFloat(fixed_digit_gst);
        $(bill_total_amount).val(total_amt.toFixed(2));
        var grand = 0
		for(var d=1; d<=count; d++){
            bill_total_amount=document.getElementById('bill_total_amount'+d);
          //  alert(bill_total_amount.value);
			grand = grand + parseFloat(bill_total_amount.value)
		}
       //  alert(grand);
		console.log(grand)
		$('.total_amount').val(grand.toFixed(2));
    }

    
    function ProductChange(val,num)
    {
        var price=document.getElementById('b_price'+num);
        var gst=document.getElementById('gst_per'+num);
        var s_item_name=document.getElementById('s_item_name'+num);
        var s_price=document.getElementById('s_price'+num);
        var s_gst_per=document.getElementById('s_gst_per'+num);
        //var royalty_amt=document.getElementById('royalty_amt'+num);
        var hdn_royalty=document.getElementById('hdn_royalty'+num);
        var hdn_s_royalty=document.getElementById('hdn_s_royalty'+num);
        
         var dat = $(val).find(':selected').attr('class');
         //$('#s_item_name1').val.options[val.selectedIndex].text;
        hdn_royalty.value = dat;
         var dd = dat.split(','); 
         gst.value=dd[2];
         //price.value=dd[3];
         //value=dd[2]; // % GST   
         //alert(value=dd[4]); // Royalty   
         //alert(value=dd[5]); // Is GST on Royalty Flag (True OR False)
         if (dd[5] == 'True') {
           price.value=dd[1];
           s_price.value=dd[0];
            } else {
           price.value=dd[3];
           s_price.value=dd[6];

            }


         var billAmnt = $('#qty').val()*$('#b_price').val();
            
        //$('#billing_amount').val(billAmnt.toFixed(2));
        $('#bill_discounted_amount').val(billAmnt.toFixed(2));
           
        var manual_GST = $('#gst_amt').val();
        //var manual_Bill_Amt = $('#billing_amount').val();
        var manual_Bill_Amt = $('#bill_discounted_amount').val();
        var fixed_digit_total_amt = parseFloat(manual_GST)+parseFloat(manual_Bill_Amt);

        //$('#total_amount').val(fixed_digit_total_amt.toFixed(2));
        var manualGSTpercentage =  $('#gst_per').val();
        
        var fixed_digit_gst = parseFloat(manual_Bill_Amt)*parseFloat(manualGSTpercentage)/100;
        $('#gst_amt').val(fixed_digit_gst.toFixed(2));
        var total_amt = parseFloat(billAmnt)+parseFloat(fixed_digit_gst);
        $('#total_amount').val(total_amt.toFixed(2));
        
        $('#s_gst_amt').val($('#gst_amt').val());
        
        $('#discount').val(0);
        $('#bill_discounted_price').val(0);
        $('#sale_discounted_price').val(0);
        var s_item = val.options[val.selectedIndex].text;
        s_item_name.value= s_item;
        //s_price.value = dd[0];
        s_gst_per.value = dd[2];
        
       // $('#s_item_name').val(s_item); 
    }

    function SaleQuantityChange(val,num)
    {   
        var total_amount = new Array();
        var totalAmt;
        var price=document.getElementById('s_price'+num);
        var sale_qty=document.getElementById('s_qty'+num);
        var gst=document.getElementById('s_gst_per'+num);
        var sale_discounted_amount=document.getElementById('sale_discounted_amount'+num);
        var s_gst_amt=document.getElementById('s_igst_amt'+num);
        var bill_total_amount=document.getElementById('sale_total_amount'+num);
        var total_amount=document.getElementById('sale_grand_amount1');
        var count=document.getElementById('hdnTxtControlNumber').value;
        var s_royalty_amt=document.getElementById('s_royalty_amt'+num);
        var s_hdn_royalty=document.getElementById('hdn_royalty'+num);
        
        var dat = s_hdn_royalty.value;
        var dd = dat.split(',');
        //alert(s_royalty_amt);
        s_royalty_amt.value=$(val).val()*dd[4];
        //alert($(val).val()*dd[4]);



        //alert('quantitychaange');
        var billAmnt = $(val).val()*$(price).val();
       // $(sale_discounted_amount).val(billAmnt.toFixed(2));
          sale_discounted_amount.value = billAmnt;
       // var manual_Bill_Amt = $(sale_discounted_amount).val();
        var manualGSTpercentage =  $(gst).val();
        
        // alert(manualGSTpercentage);
        //var fixed_digit_gst = parseFloat(billAmnt)*parseFloat(manualGSTpercentage)/100;
        var fixed_digit_gst = s_gst_amt.value;
        if (fixed_digit_gst.length < 0 || fixed_digit_gst == '')
            fixed_digit_gst = 0;
        //$(s_gst_amt).val(fixed_digit_gst.toFixed(2));
        
        //Total Amount
        var total_amt = parseFloat(billAmnt)+parseFloat(fixed_digit_gst);
        //$(bill_total_amount).val(total_amt.toFixed(2));
        var total_amt_royalty = parseFloat(billAmnt)+parseFloat(fixed_digit_gst)+parseFloat($(val).val()*dd[4]);
        if (dd[5] == 'True')
            $(bill_total_amount).val(total_amt.toFixed(2));
           else
            $(bill_total_amount).val(total_amt_royalty.toFixed(2));   

        //bill_total_amount.value = total_amt.toFixed(2);
        var grand = 0
		for(var d=1; d<=count; d++){
            bill_total_amount=document.getElementById('sale_total_amount'+d);
          //  alert(bill_total_amount.value);
			grand = grand + parseFloat(bill_total_amount.value)
		}
         //alert(grand);
		console.log(grand)
		$('.sale_grand_amount').val(grand.toFixed(2));

        $('.grand_total').val($('.sale_grand_amount').val());
        var adv = $('.advance').val();
        var adv1 = $('.s_pay_received').val();
        var adv2 = $('.sale_grand_amount').val();
        
        var sumadv = parseFloat(adv1)+parseFloat(adv);
        
        //var pending = $('.sale_grand_amount').val()-($('.advance').val()+$('.s_pay_received').val());
        //alert(pending); 
        $('.total_pending').val(adv2-sumadv);


    }

    function SaleRateChange(val,num)
    {
        var qty=document.getElementById('s_qty'+num);
        var gst=document.getElementById('s_gst_per'+num);
        var sale_discounted_amount=document.getElementById('sale_discounted_amount'+num);
        var igst_amt=document.getElementById('s_igst_amt'+num);
        var bill_total_amount=document.getElementById('sale_total_amount'+num);
        //alert(bill_total_amount.id);
        //alert(typeof(bill_total_amount));
        var total_amount=document.getElementById('sale_grand_amount1');
        var count=document.getElementById('hdnTxtControlNumber').value;
        //alert('quantitychaange');
        var billAmnt = $(val).val()*$(qty).val();
        //alert(billAmnt);
        $(sale_discounted_amount).val(billAmnt.toFixed(2));
          
        var manual_Bill_Amt = $(sale_discounted_amount).val();
        var manualGSTpercentage =  $(gst).val();
        
        // alert(manualGSTpercentage);
        var fixed_digit_gst = parseFloat(billAmnt)*parseFloat(manualGSTpercentage)/100;
        //$(igst_amt).val(fixed_digit_gst.toFixed(2));

        var fixed_digit_gst = igst_amt.value;
        if (fixed_digit_gst.length < 0 || fixed_digit_gst == '')
            fixed_digit_gst = 0;
        
        //Total Amount
        var total_amt = parseFloat(billAmnt)+parseFloat(fixed_digit_gst);
        //alert(total_amt);
        //$(bill_total_amount).val(total_amt.toFixed(2));
        bill_total_amount.value = total_amt;

        var grand = 0
		for(var d=1; d<=count; d++){
            sale_total_amount=document.getElementById('sale_total_amount'+d);
          //  alert(bill_total_amount.value);
			grand = grand + parseFloat(sale_total_amount.value)
		}
       //  alert(grand);
		console.log(grand)
		$('.sale_grand_amount').val(grand.toFixed(2));
        $('.grand_total').val($('.sale_grand_amount').val());
       
    }

</script>

<script>
    $(function() {
        $('.otherproduct').change(function(){
             var dat = $(this).find(':selected').attr('class');
             var dd = dat.split(',');  
             $('.price').val(dd[0]);
             $('.b_price').val(dd[1]);
             $('.gst_per').val(dd[2]);
             $('.out_bill_price').val(dd[1]);
            $('.b_item_name').val($(this).find(':selected').text());
            
            $('.s_price').val(dd[0]);
            $('.s_gst_per').val(dd[2]);
            //$('#bill_discounted_price').val(dd[1]);
            
            $('.s_item_name').val($(this).find(':selected').text());
            });
        });
</script>


<script>
    $('#advance_recieved').keyup(function(){
        $('#advance').val($('#advance_recieved').val());
    });
</script>




<script>
	var newrow=1;
	function removeRowBill(e){
		//console.log($(this).parent("div"))
		if(newrow>1) {
			$(e).parent("div").parent("div").remove();
			newrow--;
		}
		else{
			show_message('One Bill Detail Required.')
		}
	}
    function counttotal(){
        var val = 1
        var val1= 2
        val3 = val+val1
         //alert(val3)
    };
	function addnewbill(val){
        //var val = 1;
        var tx = document.getElementById('hdnTxtControlNumber');

        val=parseInt(tx.value)+1;
       
        tx.value= val;
      

		html = `<div id="add-new-bill-form border-1">
                        
						<div class="row mx-0 align-items-center">
							<div class="col-sm-12 px-0">
								<div class="mx-0 row bill-form">
									<div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="product">Product*</label>#}
                                            <select class="custom-select form-control form-control-user rounded-1 select2_dropdown product" name="product" id="product` + val +
                                            `" required onchange="ProductChange(this,` + val +
                                            `)" >
                                                <option value="" selected>Select</option>
                                                {% for data in products %}
                                                <option value="{{data.id}}" class="{{data.sale_rate}},{{data.bill_rate}},{{data.gst_percent}},{{data.base_bill_rate}},{{data.bill_royalty_charges}},{{data.is_gst}},{{data.base_sale_rate}},{{data.sale_royalty_charges}}">{{data.item_name}}</option>
                                                {%endfor%}
                                            </select>
                                        </div>
                                    </div>
                                    <input type="hidden" name="hdnTxtControlNumber" id="hdnTxtControlNumber` + val +
                                            `" value="1` + val +
                                            `">
									<div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="b_item_name">UOM*</label>#}
                                            <input type="text" name="uom" id="uom` + val +
                                            `" class="form-control" value="Ton" style="font-size:0.8rem;" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="qty">Qty.*</label>#}
                                            <input type="text" name="qty" id="qty` + val +
                                            `" placeholder="0.00" class="form-control qty" style="font-size:0.8rem;" onchange="QuantityChange(this,` + val +
                                            `)" required>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="b_price">Price*</label>#}
                                            <input type="text" name="b_price" style="font-size:0.8rem;" id="b_price` + val +
                                            `" placeholder="0.00" class="form-control b_price" onchange="RateChange(this,` + val +
                                            `)" {% if companies.is_dynamic != True %}readonly{%endif%}>
                                        </div>
                                    </div>
                                        {# <div class="col-lg-2 col-sm-12">
                                            <div class="form-group mb-4">
                                                <label for="bill_discounted_price">Discounted Price</label>
                                                <input type="number" name="bill_discounted_price" id="bill_discounted_price` + val +
                                            `" placeholder="0.00" class="form-control" style="font-size:0.8rem;" readonly>
                                            </div>
                                        </div>#}
                                    <div class="col-lg-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="bill_discounted_amount">Amount</label>#}
                                            <input type="number" name="bill_discounted_amount" style="font-size:0.8rem;" id="bill_discounted_amount` + val +
                                            `" placeholder="0.00" class="form-control bill_discounted_amount" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="gst_per">%GST</label>#}
                                
                                            <input type="text" name="gst_per" style="font-size:0.8rem;" id="gst_per` + val +
                                            `" {% if price_gst %} value="{{price_gst.gst_percent}}"{% endif %} placeholder="0.00" class="form-control gst_per" readonly>
                                            
                                        </div>
                                    </div>
                                    
                                    <input type="hidden" name="hdn_royalty" id="hdn_royalty` + val +`"  style="font-size:0.8rem;" class="hdn_royalty" readonly>
                                    <!--<div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="gst_amt">CGST*</label>
                                            <input type="number" name="gst_amt" id="gst_amt` + val +
                                            `" placeholder="0.00" class="form-control gst_amt" readonly>
                                        </div>
                                    </div>-->
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="gst_amt">GST*</label>#}
                                            <input type="number" name="igst_amt" id="igst_amt` + val +
                                            `" placeholder="0.00" class="form-control gst_amt" style="font-size:0.8rem;" readonly>
                                        </div>
                                    </div>
                                        <input type="hidden" name="" style="font-size:0.8rem;" id="billing_amount` + val +
                                            `" placeholder="0.00" class="form-control" readonly>
                                        {#<div class="col-md-2 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="billing_amount">Billing Amount*</label>
                                            <input type="number" name="billing_amount" id="billing_amount` + val +
                                            `" placeholder="0.00" class="form-control billing_amount" readonly>
                                        </div>
                                    </div>#}
                                        <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">

                                            <input type="text" name="royalty_amt" style="font-size:0.8rem;" id="royalty_amt` + val +
                                            `" placeholder="0.00" class="form-control royalty_amt" readonly>
                                        </div>
                                    </div>
                                    {#<div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="invoice_no">Invoice No.</label>
                                            <input type="text" name="invoice_no" id="invoice_no" class="form-control">
                                        </div>
                                    </div>#}
                                    <div class="col-md-2 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="bill_total_amount">Total Amount*</label>#}
                                            <input type="number" name="bill_total_amount" id="bill_total_amount` + val +
                                            `" placeholder="0.00" class="form-control bill_total_amount" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-12 mt-4">
                                        <a href="javascript:void(0);" class="border-primary btn" onclick="addnewbill()" style="padding:0.1rem 0.35rem!important;"><i class="fas fa-plus fz-10 delete-row mt-1"></i></a>
                                        <a type="button" class="delete-row delete-row btn border-danger text-danger" onclick="removeRowBill(this)" style="padding:0.1rem 0.35rem!important;"><i class="fas fa-trash-alt fz-10 delete-row mt-1"></i></a>
                                    </div>
								</div>
							</div>
							
						</div>
					</div>`;

		$("#add-new-bill-form").append(html);
        html1 = `<div id="add-new-bill-form border-1">
                        
						<div class="row mx-0 align-items-center">
							<div class="col-sm-12 px-0">
								<div class="mx-0 row bill-form">
									<div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="product">Product*</label>#}
                                            <input type="text" name="s_item_name" id="s_item_name` + val +
                                            `" required class="form-control" readonly>
                                        </div>
                                    </div>
                                    <input type="hidden" name="hdnTxtControlNumber" id="hdnTxtControlNumber` + val +
                                            `" value="1` + val +
                                            `">
									<div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="b_item_name">UOM*</label>#}
                                            <input type="text" name="s_uom" id="s_uom` + val +
                                            `" class="form-control" value="Ton" style="font-size:0.8rem;" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="qty">Qty.*</label>#}
                                            <input type="text" name="s_qty" id="s_qty` + val +
                                            `" placeholder="0.00" class="form-control qty" style="font-size:0.8rem;" onchange="SaleQuantityChange(this,` + val +
                                            `)" required>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="s_price">Price*</label>#}
                                            <input type="text" name="s_price" style="font-size:0.8rem;" id="s_price` + val +
                                            `" placeholder="0.00" class="form-control s_price" onchange="SaleRateChange(this,` + val +
                                            `)" {% if companies.is_dynamic != True %}readonly{%endif%}>
                                        </div>
                                    </div>
                                        
                                    <div class="col-lg-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="bill_discounted_amount">Amount</label>#}
                                            <input type="number" name="sale_discounted_amount" style="font-size:0.8rem;" id="sale_discounted_amount` + val +
                                            `" placeholder="0.00" class="form-control sale_discounted_amount" readonly>
                                        </div>
                                    </div>
                                    {#
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="gst_per">%GST</label>
                                
                                            <input type="text" name="s_gst_per" style="font-size:0.8rem;" id="s_gst_per` + val +
                                            `" placeholder="0.00" class="form-control gst_per" readonly>
                                            
                                        </div>
                                    </div>#}
                                    <!--<div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="gst_amt">CGST*</label>
                                            <input type="number" name="gst_amt" style="font-size:0.8rem;" id="gst_amt` + val +
                                            `" placeholder="0.00" class="form-control gst_amt" readonly>
                                        </div>
                                    </div>-->
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="gst_amt">GST*</label>#}
                                            <input type="number" name="s_igst_amt" style="font-size:0.8rem;" id="s_igst_amt` + val +
                                            `" placeholder="0.00" class="form-control gst_amt" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <input type="number" name="s_royalty_amt" style="font-size:0.8rem;" id="s_royalty_amt` + val +
                                            `" placeholder="0.00" class="form-control s_royalty_amt" readonly>
                                        </div>
                                    </div>
                                    <input type="hidden" name="shdn_royalty" id="hdn_s_royalty` + val +`"  style="font-size:0.8rem;" class="hdn_s_royalty" readonly>

                                        <input type="hidden" name="" id="billing_amount` + val +
                                            `" placeholder="0.00" class="form-control" readonly>
                                        {#<div class="col-md-2 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="billing_amount">Billing Amount*</label>
                                            <input type="number" name="billing_amount" id="billing_amount` + val +
                                            `" placeholder="0.00" class="form-control billing_amount" style="font-size:0.8rem;" readonly>
                                        </div>
                                    </div>#}
                                    
                                    <div class="col-md-2 col-sm-12">
                                        <div class="form-group mb-4">
                                            {#<label for="sale_total_amount">Total Amount*</label>#}
                                            <input type="number" name="sale_total_amount" id="sale_total_amount` + val +
                                            `" placeholder="0.00" class="form-control sale_total_amount" readonly>
                                        </div>
                                    </div>
								</div>
							</div>
							
						</div>
					</div>`;
		$("#add-new-sale-form").append(html1);
		newrow++;
  	return false;
	}
</script>

<script>
	var newrow=1;
	function removeRowsale(e){
		//console.log($(this).parent("div"))
		if(newrow>1) {
			$(e).parent("div").parent("div").remove();
			newrow--;
		}
		else{
			show_message('One Sale Detail Required.')
		}
	}
	function addnewsale(){

		html = `<div id="add-new-sale-form border-1">
                        
						<div class="row mx-0 align-items-center">
							<div class="col-sm-12 px-0">
								<div class="mx-0 row sale-form">
									<div class="col-lg-2 col-md-3 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="product">Product*</label>
                                            <select class="custom-select form-control form-control-user rounded-1 select2_dropdown" name="product" id="product" required onchange="ProductChange(this)>
                                                <option value="" selected>Select</option>
                                                {% for data in products %}
                                                <option value="{{data.id}}" class="{{data.sale_rate}},{{data.bill_rate}},{{data.gst_percent}},{{data.base_bill_rate}},{{data.bill_royalty_charges}},{{data.is_gst}}">{{data.item_name}}</option>
                                                {%endfor%}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-1 col-sm-12">
                                        <div class="form-group mb-4">
                                            <label for="qty">Qty.<small>(Ton)</small>*</label>
                                            <input type="text" name="qty" id="qty" placeholder="0.00" class="form-control qty" required>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-2 col-12 mt-4">
                                        <a href="javascript:void(0);" class="border-primary btn" onclick="addnewsale()"><i class="fas fa-plus fz-20 delete-row mt-1"></i></a>
                                        <a type="button" class="delete-row delete-row btn border-danger text-danger mx-3" onclick="removeRowsale(this)"><i class="fas fa-trash-alt fz-20 delete-row mt-1"></i></a>
                                    </div>
								</div>
							</div>
							
						</div>
					</div>`;
		$("#add-new-sale-form").append(html);
		newrow++;
  	return false;
	}
</script>

{% endblock %}
